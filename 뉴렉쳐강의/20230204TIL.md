# 서블릿/JSP 강의/강좌 76 - NoticeService 클래스 완성하기
* 오라클에서 데이터값 빼고는 대소문자 구분하지 않음
* NoticeService class의 getNoticeCount 함수 - 게시글 리스트를 가져왓을 때 페이징이 되지 않은 레코드의 개수 출력 함수
```
public int getNoticeCount(String field, String query) {
		
		int count =0;
		
		String sql = "SELECT COUNT(ID) COUNT FROM (" + 
				"    SELECT ROWNUM NUM, N.* " + 
				"    FROM (SELECT * FROM NOTICE WHERE "+field+" LIKE ? ORDER BY REGDATE DESC, ID DESC) N" + 
				") ";
		
		String url = "jdbc:oracle:thin:@localhost:1521/xepdb1";

		
		try {
			Class.forName("oracle.jdbc.driver.OracleDriver");
			Connection con = DriverManager.getConnection(url,"newlec","24rkwk");
			PreparedStatement st = con.prepareStatement(sql);
			
			st.setString(1, "%"+query+"%");
			
			ResultSet rs = st.executeQuery();

			count = rs.getInt("count");
			
			rs.close();
			st.close();
			con.close();

		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return count;
	}
```
* NoticeService class의 getNotice 함수 - 공지사항 하나의 레코드를 가져온다.
```
public Notice getNotice(int id) {
		Notice notice = null;
		
		String sql = "SELECT * FROM NOTICE WHERE ID=?";
		
		String url = "jdbc:oracle:thin:@localhost:1521/xepdb1";

		try {
			Class.forName("oracle.jdbc.driver.OracleDriver");
			Connection con = DriverManager.getConnection(url,"newlec","24rkwk");
			PreparedStatement st = con.prepareStatement(sql);
			
			st.setInt(1, id);
			
			ResultSet rs = st.executeQuery();

			if(rs.next()){	
				int nid = rs.getInt("ID");
				String title = rs.getString("TITLE"); 
				String writerId=rs.getString("WRITER_ID"); 
				Date regdate=rs.getDate("REGDATE"); 
				int hit=rs.getInt("HIT");
				String files=rs.getString("FILES");
				String content=rs.getString("CONTENT");
				
				notice = new Notice(
						nid,
						title,
						writerId,
						regdate,
						hit,
						files,
						content
				);

			} 



			rs.close();
			st.close();
			con.close();

		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return notice;
	}
```
* NoticeService class의 getNextNotice 함수 - 현재 id기준 다음 공지사항 하나의 레코드를 가져온다.
```
public Notice getNextNotice(int id) {
		Notice notice = null;
		
		String sql = "SELECT * FROM NOTICE " + 
				"WHERE ID =(" + 
				"SELECT ID FROM NOTICE " + 
				"WHERE REGDATE > (SELECT REGDATE FROM NOTICE WHERE ID =?) " + 
				"AND ROWNUM =1" + 
				");";
		
		try {
			Class.forName("oracle.jdbc.driver.OracleDriver");
			Connection con = DriverManager.getConnection(url,"newlec","24rkwk");
			PreparedStatement st = con.prepareStatement(sql);
			
			st.setInt(1, id);
			
			ResultSet rs = st.executeQuery();

			if(rs.next()){	
				int nid = rs.getInt("ID");
				String title = rs.getString("TITLE"); 
				String writerId=rs.getString("WRITER_ID"); 
				Date regdate=rs.getDate("REGDATE"); 
				int hit=rs.getInt("HIT");
				String files=rs.getString("FILES");
				String content=rs.getString("CONTENT");
				
				notice = new Notice(
						nid,
						title,
						writerId,
						regdate,
						hit,
						files,
						content
				);

			} 



			rs.close();
			st.close();
			con.close();

		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return notice;
	}
```
* NoticeService class의 getPrevNotice 함수 - 현재 id기준 이전 공지사항 하나의 레코드를 가져온다.
```
public Notice getPrevNotice(int id) {
		Notice notice = null;
		
		String sql = "SELECT ID FROM (SELECT * FROM NOTICE ORDER BY REGDATE DESC) " + 
				"WHERE REGDATE < (SELECT REGDATE FROM NOTICE WHERE ID =?) " + 
				"AND ROWNUM =1;";
		
		try {
			Class.forName("oracle.jdbc.driver.OracleDriver");
			Connection con = DriverManager.getConnection(url,"newlec","24rkwk");
			PreparedStatement st = con.prepareStatement(sql);
			
			st.setInt(1, id);
			
			ResultSet rs = st.executeQuery();

			if(rs.next()){	
				int nid = rs.getInt("ID");
				String title = rs.getString("TITLE"); 
				String writerId=rs.getString("WRITER_ID"); 
				Date regdate=rs.getDate("REGDATE"); 
				int hit=rs.getInt("HIT");
				String files=rs.getString("FILES");
				String content=rs.getString("CONTENT");
				
				notice = new Notice(
						nid,
						title,
						writerId,
						regdate,
						hit,
						files,
						content
				);

			} 



			rs.close();
			st.close();
			con.close();

		} catch (ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return notice;
	}
```

# 서블릿/JSP 강의/강좌 77 - 목록 페이지에서 검색 추가하기
* Controller의 역할 중 하나는 사용자의 입력값을 받는 것
* 목록 페이지에서 query인자 받아서 함수 호출
   * NoticeListController class 의 doGet함수에서 인자값 받아오기, controller단에서 사용자 입력 받음
   ```
   String field_ = request.getParameter("f");
		String query_ = request.getParameter("q");
		
		String field = "title";
		if(field_ != null && !field_.equals(""))
			field = field_;
		
		String query = "";
		if(query_ != null && !query_.equals(""))
			query = query_;
   ```
* 검색창에서 데이터 유지
   * list.jsp안의 form태그
   ```
   <form class="table-form">
					<fieldset>
						<legend class="hidden">공지사항 검색 필드</legend>
						<label class="hidden">검색분류</label>
						<select name="f">
							<option ${(param.f=="title")?"selected":""}  value="title">제목</option> //select bar의 값을 query의 parameter값에 따라서 유지
							<option ${(param.f=="writer_Id")?"selected":""} value="writer_Id">작성자</option>
						</select> 
						<label class="hidden">검색어</label>
						<input type="text" name="q" value="${param.q}"/> //검색어 창의 값을 query의 parameter값을 통해 유지
						<input class="btn btn-search" type="submit" value="검색" />
					</fieldset>
				</form>
   ```
   
# 
